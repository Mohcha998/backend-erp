name: Notify Discord

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord notification
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            TITLE="ðŸš€ Push to master"
            DESCRIPTION="**Commit:** ${{ github.event.head_commit.message }}"
            URL="${{ github.event.head_commit.url }}"
            COLOR=3066993
          else
            TITLE="ðŸ”µ Pull Request"
            DESCRIPTION="**Title:** ${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            COLOR=3447003
          fi

          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"username\": \"GitHub Bot\",
              \"embeds\": [{
                \"title\": \"$TITLE\",
                \"description\": \"$DESCRIPTION\",
                \"url\": \"$URL\",
                \"color\": $COLOR,
                \"fields\": [
                  {
                    \"name\": \"Repository\",
                    \"value\": \"${{ github.repository }}\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"Author\",
                    \"value\": \"${{ github.actor }}\",
                    \"inline\": true
                  }
                ],
                \"footer\": {
                  \"text\": \"GitHub Actions â€¢ Auto Notification\"
                }
              }]
            }" \
            ${{ secrets.DISCORD_WEBHOOK }}
